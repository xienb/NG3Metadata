

Ext.define('Ext.ux.TriggerField', {
    extend: 'Ext.form.field.Trigger',
    helpid: 'secuser',
    onTriggerClick: function () {

        Ext.define('model', {
            extend: 'Ext.data.Model',
            fields: [{
                name: 'code',
                type: 'string',
                mapping: 'code'
            }, {
                name: 'name',
                type: 'string',
                mapping: 'name'
            }
            ]
        });

        var store = Ext.create('Ext.data.Store', {
            model: 'model',
            pageSize: 20,
            proxy: {
                type: 'ajax',
                url: '../Help/GetItemHelp',
                reader: {
                    type: 'json',
                    root: 'items',
                    totalProperty: 'total'
                }
            }
        });
        store.load();

        var pagingbar = Ext.create('Ext.PagingToolbar', {
            store: store,
            displayInfo: true,
            displayMsg: '第 {0} - {1}条 共 {2} 条数据',
            emptyMsg: "没有任何数据",
            beforePageText: "第",
            afterPageText: "/{0} 页",
            firstText: "首页",
            prevText: "上一页",
            nextText: "下一页",
            lastText: "尾页",
            refreshText: "刷新"
        });

        var grid = Ext.create('Ext.grid.Panel', {
            region: 'center',
            //frame: true,
            store: store,
            columnLines: true,
            //selType: 'cellmodel',
            //selModel: Ext.create('Ext.selection.CheckboxModel'),
            layout: {
                type: 'hbox',
                align: 'stretch'
            },
            columns: [Ext.create('Ext.grid.RowNumberer', { text: '行号', width: 35 }),
             {
                 header: '代码',
                 flex: 1,
                 sortable: true,
                 dataIndex: 'code',
                 hidden: false
             }, {
                 header: '名称',
                 flex: 1,
                 sortable: true,
                 dataIndex: 'name',
                 editor: {
                     allowBlank: false
                 }
             }],
            viewConfig: {
                forceFit: true,
                scrollOffset: 0
            },
            //forceFit: true,
            //plugins: [cellEditing],
            bbar: pagingbar
        });

        var win = Ext.create('Ext.window.Window', {
            title: 'Hello',
            height: 300,
            width: 400,
            layout: 'fit',
            items: [grid]
        }).show();

        var me = this;

        grid.on('itemdblclick', function () {
            ;
            var data = grid.getSelectionModel().getSelection();

            if (data.length > 0) {
                var code = data[0].get('code');
                var name = data[0].get('name');
                this.setValue(code);
                win.hide();
            }
        }, this)

    }
})

Ext.define('Ext.ux.ComboBox', {
    extend: 'Ext.form.ComboBox',
    pageSize: 10,
    minChars: 1,
    //fieldLabel: 'Country:',
    //hiddenName: String,
    valueField: 'code',
    displayField: 'name',
    //forceSelection: true,
    //selectOnFoucus: true,
    typeAhead: true,//延时查询
    typeAheadDelay: 1000,//延迟500毫秒，默认是250
    //valueNotFoundText: 'Select a Country!!...',
    mode: 'remote',
    triggerAction: 'all', //'query',
    //emptyText: 'Select a Country...',
    store: new Ext.data.JsonStore({
        //url: 'Help/GetProvince',
        pageSize: 10,//这个决定页大小
        //autoLoad:true,
        fields: [
        { name: 'name', mapping: 'name' },
        { name: 'code', mapping: 'code' },
        { name: 'flag', mapping: 'flag' }
        ],
        proxy: {
            type: 'ajax',
            url: 'Help/GetProvince',
            reader: {
                type: 'json',
                root: 'provinces',
                totalProperty: 'total'
                //idProperty: 'name'
            }
        }
        //root:'provinces',
        //sortInfo:{field: "name", direction: "ASC"}
    }),
    listeners: {
        load: function (records, operation, success) {
            alert('xx');
            //this.setValue(this.getValue);
        }
    },
    //tpl: '<tpl for="."><div ext:qtip="{name}. ({code})" class="x-combo-list-item"><img src="resources/images/flags/{flag}.png" width="16" height="11" alt="" border="0" />{name}</div></tpl>',
    initComponent: function () {
        this.callParent();

        var me = this;

        this.store.on("load", function (records, operation, success) {
            ;
            //alert(me.getValue());
            //me.setValue(me.getValue());
        });
    },
    onTriggerClick: function () {
        var me = this;
        //this.setRawValue('01');

        Ext.define('model', {
            extend: 'Ext.data.Model',
            fields: [{
                name: 'code',
                type: 'string',
                mapping: 'code'
            }, {
                name: 'name',
                type: 'string',
                mapping: 'name'
            }
            ]
        });

        var store = Ext.create('Ext.data.Store', {
            model: 'model',
            pageSize: 20,
            proxy: {
                type: 'ajax',
                url: '../Help/GetItemHelp',
                reader: {
                    type: 'json',
                    root: 'items',
                    totalProperty: 'total'
                }
            }
        });
        store.load();

        var pagingbar = Ext.create('Ext.PagingToolbar', {
            store: store,
            displayInfo: true,
            displayMsg: '第 {0} - {1}条 共 {2} 条数据',
            emptyMsg: "没有任何数据",
            beforePageText: "第",
            afterPageText: "/{0} 页",
            firstText: "首页",
            prevText: "上一页",
            nextText: "下一页",
            lastText: "尾页",
            refreshText: "刷新"
        });

        var grid = Ext.create('Ext.grid.Panel', {
            region: 'center',
            //frame: true,
            store: store,
            columnLines: true,
            //selType: 'cellmodel',
            //selModel: Ext.create('Ext.selection.CheckboxModel'),
            layout: {
                type: 'hbox',
                align: 'stretch'
            },
            columns: [Ext.create('Ext.grid.RowNumberer', { text: '行号', width: 35 }),
             {
                 header: '代码',
                 flex: 1,
                 sortable: true,
                 dataIndex: 'code',
                 hidden: false
             }, {
                 header: '名称',
                 flex: 1,
                 sortable: true,
                 dataIndex: 'name',
                 editor: {
                     allowBlank: false
                 }
             }],
            viewConfig: {
                forceFit: true,
                scrollOffset: 0
            },
            //forceFit: true,
            //plugins: [cellEditing],
            bbar: pagingbar
        });

        var win = Ext.create('Ext.window.Window', {
            title: 'Hello',
            height: 300,
            width: 400,
            layout: 'fit',
            items: [grid]
        }).show();


        grid.on('itemdblclick', function () {
            ;
            var data = grid.getSelectionModel().getSelection();

            if (data.length > 0) {
                var code = data[0].get('code');
                var name = data[0].get('name');
                this.setValue(code);
                this.setRawValue(name);
                //alert(code);
                win.hide();
            }
        }, this)

    }

})